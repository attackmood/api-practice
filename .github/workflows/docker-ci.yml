name: Docker CI/CD

on:
  push:
    branches:
      - master  # main ë¸Œëœì¹˜ì— pushë  ë•Œ ì‹¤í–‰

jobs:
  build-and-push:
    runs-on: ubuntu-latest  # GitHub Actionsì—ì„œ ì‚¬ìš©í•  OS í™˜ê²½

    steps:
      - name: ğŸ›‘ ë ˆí¬ì§€í† ë¦¬ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4  # GitHub ì €ì¥ì†Œì—ì„œ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°

      - name: â˜• Java 17 ì„¤ì •
        uses: actions/setup-java@v4  # Java 17ì„ ì„¤ì •
        with:
          java-version: '11'
          distribution: 'temurin'

      - name: ğŸ—ï¸ Gradle ì„¤ì •
        uses: gradle/actions/setup-gradle@v4  # Gradle ìë™ ì„¤ì • ë° ìºì‹± í™œì„±í™”

      - name: ğŸ”¨ Spring Boot ë¹Œë“œ (Gradle)
        run: ./gradlew build  # ê³µì‹ ë¬¸ì„œ ë°©ì‹ ì ìš©

      - name: ğŸ“¦ ë¹Œë“œëœ JAR ì €ì¥ (ì„ íƒ ì‚¬í•­)
        uses: actions/upload-artifact@v4
        with:
          name: Package
          path: build/libs/*.jar  # ë¹Œë“œëœ JARì„ GitHub Actionsì— ì—…ë¡œë“œ

      - name: ğŸ—ï¸ Docker ë¹Œë“œ
        run: docker build -t my-dockerhub-id/my-app:latest .

      - name: ğŸ”‘ Docker Hub ë¡œê·¸ì¸
        run: echo "${{ secrets.DOCKER_PASSWORD }}" | docker login -u "${{ secrets.DOCKER_USERNAME }}" --password-stdin

      - name: ğŸš€ Docker Hubì— í‘¸ì‹œ
        run: docker push my-dockerhub-id/my-app:latest
